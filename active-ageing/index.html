<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Active Ageing</title>
  <link rel="stylesheet" href="../styles.css">
 <!-- Standard favicon -->
  <link rel="icon" href="../favicon.png" type="image/png">

  <!-- Apple Touch Icon -->
  <link rel="apple-touch-icon" href="../favicon-180x180.png">

  <!-- Optional for higher resolution screens -->
  <link rel="icon" sizes="32x32" href="../favicon-32x32.png">
  <link rel="icon" sizes="16x16" href="../favicon-16x16.png">
  <link rel="icon" sizes="48x48" href="../favicon-48x48.png">
  <link rel="icon" sizes="96x96" href="../favicon-96x96.png">
  <link rel="icon" sizes="192x192" href="../favicon-192x192.png">
</head>
  
<body class="iot">
  <div class="loading-screen">
    <img src="../logos/logo.gif" alt="Loading...">
</div>

 <!-- Top Banner -->
<div class="top-banner">
  <div class="logo">
    <a href="/" class="logo-link">
      <img 
        src="../logos/logo.png" 
        data-gif="../logos/logo.gif" 
        data-duration="1520"
        alt="Logo" 
        class="logo-img"
      >
    </a>
  </div>
  <div class="menu">
    <a href="#Connect">Connect</a>
  </div>
</div>


  <!-- Page Content -->

  <div class="iot-page-container">
    <!-- Logo Section -->
    <div class="iot-logo-container">
        <img src="../media/IoTtitle.png" alt="Logo" class="iot-logo">
    </div>
    
<div class="iot-video-container">
    <video controls autoplay muted loop>
        <source src="../media/activeageing.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>
      <a href="https://dl.acm.org/doi/abs/10.1145/3679318.3685410" class="iot-read-paper-btn" target="_blank">Read Paper</a>

   </div>
 <!-- Horizontal Line -->
    <div class="section-divider"></div>

    <!-- Title -->
    <h2 class="section-title">Self Powered, low level sensors</h2>

    <!-- Image Row -->
    <div class="iot-image-row">
        <!-- Image 1 -->
        <div>
            <img src="../media/switch.webp" alt="Switch module">
            <p class="iot-image-caption">A switch to detect movement of doors & drawers</p>
        </div>

        <!-- Image 2 -->
        <div>
            <img src="../media/photocell.webp" alt="Photocell module">
            <p class="iot-image-caption">A photocell to detect light</p>
        </div>

        <!-- Image 3 -->
        <div>
            <img src="../media/pir.webp" alt="PIR module">
            <p class="iot-image-caption">A passive infrared sensor
to detect movement</p>
        </div>
    </div>

     <!-- SVG Container for Heatmap -->
     <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #chart {
            margin-bottom: 20px;
        }
        #nav {
            display: flex;
            justify-content: space-between;
            margin: 20px;
        }
        .arrow {
            cursor: pointer;
            font-size: 24px;
        }
    </style>
</head>
<body>
    <div id="nav">
        <span class="arrow" id="prev-day">&#8592; Previous Day</span>
        <span id="current-day">Day: </span>
        <span class="arrow" id="next-day">Next Day &#8594;</span>
    </div>

    <div id="chart"></div>

    <script>
        // Sample Data
        const data = [
            "15-08-2023, 13:52:22, Kitchen Light",
            "15-08-2023, 15:02:28, Cutlery Cupboard",
            "15-08-2023, 15:47:53, Cutlery Cupboard",
            "16-08-2023, 10:02:00, Fridge",
            "16-08-2023, 12:30:40, Pan Draw",
            "17-08-2023, 14:15:22, Kitchen Light",
            "17-08-2023, 17:22:00, Cutlery Cupboard",
            "17-08-2023, 18:32:50, Fridge"
        ];

        // Categories for color mapping
        const eventCategories = {
            "Cooking/Eating": ["Pan Draw", "Cutlery Cupboard", "Fridge"],
            "Kitchen Light": ["Kitchen Light"]
        };

        const categoryMultipliers = {
            "Cooking/Eating": 2,
            "Kitchen Light": 10
        };

        // Parsing data to group by day
        const daysData = {};

        data.forEach(item => {
            const parts = item.split(", ");
            const day = parts[0]; // Extract the day
            const event = parts[2]; // Extract the event
            if (!daysData[day]) {
                daysData[day] = {};
            }
            daysData[day][event] = (daysData[day][event] || 0) + 1;
        });

        const allDays = Object.keys(daysData);
        let currentDayIndex = 0;

        // Setting up chart size
        const width = 800;
        const height = 400;

        // Create the SVG container for the chart
        const svg = d3.select("#chart")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        // Function to update the chart for a selected day
        function updateChart(day) {
            const eventCounts = daysData[day];

            // Find the highest and lowest incidence per category
            Object.keys(eventCategories).forEach(category => {
                const categoryEvents = eventCategories[category];
                const categoryData = categoryEvents.reduce((acc, event) => {
                    acc[event] = eventCounts[event] || 0;
                    return acc;
                }, {});

                // Find max and min for color scaling
                const maxIncidence = Math.max(...Object.values(categoryData));
                const minIncidence = Math.min(...Object.values(categoryData));

                // Set color scale based on the max and min incidences
                const colorScale = d3.scaleLinear()
                    .domain([minIncidence, maxIncidence])
                    .range(["blue", "red"]);

                // Draw the bars for this category
                const x = d3.scaleBand()
                    .domain(categoryEvents)
                    .range([0, width])
                    .padding(0.1);

                const y = d3.scaleLinear()
                    .domain([0, d3.max(Object.values(categoryData))])
                    .nice()
                    .range([height, 0]);

                // Remove old bars and axes
                svg.selectAll("*").remove();

                // Add bars to the chart with dynamic colors
                svg.selectAll(".bar")
                    .data(Object.entries(categoryData))
                    .enter()
                    .append("rect")
                    .attr("class", "bar")
                    .attr("x", d => x(d[0]))
                    .attr("y", d => y(d[1]))
                    .attr("width", x.bandwidth())
                    .attr("height", d => height - y(d[1]))
                    .attr("fill", d => colorScale(d[1]));

                // Add x-axis
                svg.append("g")
                    .attr("transform", `translate(0, ${height})`)
                    .call(d3.axisBottom(x));

                // Add y-axis
                svg.append("g")
                    .call(d3.axisLeft(y));
            });

            // Update current day label
            document.getElementById("current-day").textContent = `Day: ${day}`;
        }

        // Initial chart update
        updateChart(allDays[currentDayIndex]);

        // Event listener for previous day arrow
        document.getElementById("prev-day").addEventListener("click", () => {
            if (currentDayIndex > 0) {
                currentDayIndex--;
                updateChart(allDays[currentDayIndex]);
            }
        });

        // Event listener for next day arrow
        document.getElementById("next-day").addEventListener("click", () => {
            if (currentDayIndex < allDays.length - 1) {
                currentDayIndex++;
                updateChart(allDays[currentDayIndex]);
            }
        });
    </script>
  


  <!-- Include the JavaScript file at the end of the body -->
  <script src="heatmap.js"></script>
  <script src="../main.js"></script>
</body>
</html>
